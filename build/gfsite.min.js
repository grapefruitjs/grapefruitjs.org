/**
 * @license
 * GrapeFruit Website - v0.0.1
 * Copyright (c) 2013, Chad Engler
 * https://github.com/grapefruitjs/grapefruitjs.org
 *
 * Compiled: 2013-10-12
 *
 * GrapeFruit Website is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(a,b){a(function(){function c(a){this.game=a,this.locked=!1,this.maxHealth=3,this.health=3,this.moveSpeed=200,this.atlas=a.cache.getTextures("players"),this.type="p1/p1_";var b={};this.addAnim(b,"duck"),this.addAnim(b,"hurt"),this.addAnim(b,"jump"),this.addAnim(b,"stand"),this.addAnim(b,"walk",11),gf.Sprite.call(this,b,1,"stand"),a.physics.addSprite(this),this.actions={move:{}},this.movement=new gf.Vector,this.bindKeys(),this.anchor.x=.5,this.gfx=new gf.PIXI.Graphics,a.world.addChild(this.gfx)}function d(a){var b=a.cache.getTextures("items")["cloud"+gf.math.randomInt(1,3)+".png"];this.game=a,this.movespeed=gf.math.randomInt(10,25),this._dx=0,gf.Sprite.call(this,b),this.position.x=gf.math.randomInt(0,a.width-this.width),this.position.y=gf.math.randomInt(0,a.height-this.height-150)}function e(){for(var a=1;10>a;++a)j.world.add.obj(new d(j));b.map=j.world.add.tilemap("world",!0),b.player=b.map.findLayer("player").addChild(new c(j)),j.camera.follow(b.player)}function f(){j.state.active.destroy(),j.state.add("__default",!0)}gf.inherit(c,gf.Sprite,{addAnim:function(a,b,c){if(c){a[b]={frames:[],speed:.8,loop:!0};for(var d=1;c>=d;++d){var e=(10>d?"0":"")+d;a[b].frames.push(this.atlas[this.type+b+e+".png"])}}else a[b]=[this.atlas[this.type+b+".png"]]},bindKeys:function(){this.game.input.keyboard.on(gf.Keyboard.KEY.W,this._boundMoveUp=this.onMove.bind(this,"up")),this.game.input.keyboard.on(gf.Keyboard.KEY.A,this._boundMoveLeft=this.onMove.bind(this,"left")),this.game.input.keyboard.on(gf.Keyboard.KEY.D,this._boundMoveRight=this.onMove.bind(this,"right"))},onMove:function(a,b){if(b.originalEvent&&b.originalEvent.preventDefault(),b.down){if(this.actions.move[a])return;this.actions.move[a]=!0}else this.actions.move[a]=!1;this._checkMovement()},lock:function(){this.setVelocity([0,0]),this.locked=!0},unlock:function(){this._setMoveAnimation(),this.setVelocity(this.movement),this.locked=!1},isGrounded:function(){return this.body.touching&gf.DIRECTION.BOTTOM},onCollide:function(a){this._setMoveAnimation(),this.gfx.clear(),gf.debug.drawBodyShape(this.body,{size:1,color:16711935,alpha:1},this.gfx),gf.debug.drawBodyShape(a.body,{size:1,color:16711935,alpha:1},this.gfx)},_checkMovement:function(){this.movement.x=this.actions.move.left&&this.actions.move.right?0:this.actions.move.left?-this.moveSpeed:this.actions.move.right?this.moveSpeed:0,this.movement.y=this.actions.move.up&&this.isGrounded()?2*-this.moveSpeed:0,this.locked||(this.body.velocity.x=this.movement.x,this.movement.y&&(this.body.velocity.y=this.movement.y,this.body.touching&=~gf.DIRECTION.BOTTOM),this._setMoveAnimation())},_setMoveAnimation:function(a){var b;b=a?a:this.isGrounded()?this.movement.x?"walk":"stand":"jump",this.movement.x&&(this.scale.x=this.movement.x>0?1:-1),this.currentAnimation!==b&&this.goto(0,b).play()}}),gf.inherit(d,gf.Sprite,{updateTransform:function(){this._dx+=this.movespeed*this.game.timings.lastDelta;var a=gf.math.floor(this._dx);a&&(this.position.x-=a,this._dx-=a,this.position.x<-this.width&&(this.position.x=this.game.width)),gf.Sprite.prototype.updateTransform.apply(this,arguments)}});var g=a("#demo"),h=g.width(),i=g.height(),j=new gf.Game(g[0],{width:h,height:i,transparent:!0});j.load.atlas("items","game/data/items.png","game/data/items.json",null,gf.ATLAS_FORMAT.JSON_HASH),j.load.atlas("players","game/data/players.png","game/data/players.json",null,gf.ATLAS_FORMAT.JSON_HASH),j.load.tilemap("world","game/data/world.json",null,gf.FILE_FORMAT.JSON),j.load.on("complete",function(){e(),j.render()}),j.load.start(),b.setup=e,b.teardown=f,b.game=j,gf.debug.show(j)})}(jQuery,window);