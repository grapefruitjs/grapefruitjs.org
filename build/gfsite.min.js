/**
 * @license
 * GrapeFruit Website - v0.0.1
 * Copyright (c) 2013, Chad Engler
 * https://github.com/grapefruitjs/grapefruitjs.org
 *
 * Compiled: 2013-09-22
 *
 * GrapeFruit Website is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(a,b){a(function(){function c(a){this.game=a,this.locked=!1,this.maxHealth=3,this.health=3,this.moveSpeed=200,this.atlas=a.cache.getTextures("players"),this.type="p1/p1_";var b={};this.addAnim(b,"duck"),this.addAnim(b,"hurt"),this.addAnim(b,"jump"),this.addAnim(b,"stand"),this.addAnim(b,"walk",11),gf.AnimatedSprite.call(this,b,1,"stand"),a.state.active.physics.addSprite(this),this.actions={move:{}},this.movement=new gf.Vector,this.bindKeys()}function d(a){var b=a.cache.getTextures("items")["cloud"+gf.math.randomInt(1,3)+".png"];this.speed=gf.math.randomInt(8,20),this._dx=0,gf.Sprite.call(this,b),this.position.x=gf.math.randomInt(0,a.width-this.width),this.position.y=gf.math.randomInt(0,a.height-this.height-150)}function e(){for(var a=1;10>a;++a)k.world.add.obj(new d(k));var b=k.world.add.tilemap("world",!0);b.findLayer("player").addChild(g=new c(k)),k.camera.follow(g)}function f(){k.state.active.destroy(),k.state.add("__default",!0)}gf.inherit(c,gf.AnimatedSprite,{addAnim:function(a,b,c){if(c){a[b]={frames:[],speed:.8,loop:!0};for(var d=1;c>=d;++d){var e=(10>d?"0":"")+d;a[b].frames.push(this.atlas[this.type+b+e+".png"])}}else a[b]=[this.atlas[this.type+b+".png"]]},bindKeys:function(){this.game.input.keyboard.on(gf.Keyboard.KEY.W,this._boundMoveUp=this.onMove.bind(this,"up")),this.game.input.keyboard.on(gf.Keyboard.KEY.S,this._boundMoveDown=this.onMove.bind(this,"down")),this.game.input.keyboard.on(gf.Keyboard.KEY.A,this._boundMoveLeft=this.onMove.bind(this,"left")),this.game.input.keyboard.on(gf.Keyboard.KEY.D,this._boundMoveRight=this.onMove.bind(this,"right"))},onMove:function(a,b){if(b.originalEvent&&b.input.preventDefault(b.originalEvent),b.down){if(this.actions.move[a])return;this.actions.move[a]=!0}else this.actions.move[a]=!1;this._checkMovement()},lock:function(){this.setVelocity([0,0]),this.locked=!0},unlock:function(){this._setMoveAnimation(),this.setVelocity(this.movement),this.locked=!1},_checkMovement:function(){this.movement.x=this.actions.move.left&&this.actions.move.right?0:this.actions.move.left?-this.moveSpeed:this.actions.move.right?this.moveSpeed:0,this.movement.y=this.actions.move.up&&this.actions.move.down?0:this.actions.move.up?-this.moveSpeed:this.actions.move.down?this.moveSpeed:0,this.locked||(this._setMoveAnimation(),this.body.velocity.copy(this.movement))},_setMoveAnimation:function(a){var b;b=a?a:this.movement.y?"jump":this.movement.x?"walk":"stand",this.movement.x&&(this.movement.x>0?(this.scale.x=1,this.anchor.x=0):(this.scale.x=-1,this.anchor.x=1)),this.gotoAndPlay(b)}}),gf.inherit(d,gf.Sprite,{updateTransform:function(){this._dx+=this.speed*k.timings.lastDelta;var a=gf.math.floor(this._dx);a&&(this.position.x-=a,this._dx-=a,this.position.x<-this.width&&(this.position.x=i)),gf.Sprite.prototype.updateTransform.apply(this,arguments)}});var g,h=a("#demo"),i=h.width(),j=h.height(),k=new gf.Game(h[0],{width:i,height:j,transparent:!0});k.load.atlas("items","game/data/items.png","game/data/items.json",null,gf.ATLAS_FORMAT.JSON_HASH),k.load.atlas("players","game/data/players.png","game/data/players.json",null,gf.ATLAS_FORMAT.JSON_HASH),k.load.tilemap("world","game/data/world.json",null,gf.FILE_FORMAT.JSON),k.load.on("complete",function(){e(),k.render()}),k.load.start(),b.gfdemo={game:k,setup:e,teardown:f}})}(jQuery,window);